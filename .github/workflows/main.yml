name: Deploy NestJS to VPS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Deploy to VPS
        uses: appleboy/ssh-action@v1
        with:
          host: 88.222.213.106
          username: root
          key: |
          -----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
          script: |
            echo "Deploying NestJS app..."
            cd ~/office_work/AAONISA-BACKEND || exit 1
            git pull origin main || { echo 'Git pull failed'; exit 1; }
            npm install || { echo 'npm install failed'; exit 1; }
            npm run build || { echo 'Build failed'; exit 1; }
            pm2 restart backend || { echo 'PM2 restart failed'; exit 1; }
            echo "Deployment finished successfully âœ…"
            
